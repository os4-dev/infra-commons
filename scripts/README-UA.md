# Інфраструктурні Загальні Компоненти - Скрипти

Ця директорія містить скрипти, призначені для автоматизації встановлення поширених інструментів інфраструктури як коду (IaC) та пов'язаних утиліт розробки на системах базі Debian/Ubuntu.

## Огляд Скриптів

-   **`install_iac_tools.sh`**:
    Основний керуючий скрипт. Він готує систему, встановлює залежності та викликає інші специфічні скрипти встановлення для інструментів IaC (Ansible, OpenTofu). Може опціонально встановлювати інструменти розробки на основі прапорців командного рядка. Використовуйте цей скрипт як основну точку входу.
-   **`install_ansible.sh`**:
    Обробляє конкретні кроки для встановлення Ansible, включаючи додавання необхідного PPA на основі кодового імені ОС (передається як аргумент скриптом `install_iac_tools.sh`). Зазвичай цей скрипт **не призначений для прямого запуску**.
-   **`install_opentofu.sh`**:
    Обробляє конкретні кроки для завантаження та встановлення OpenTofu з його офіційного репозиторію. Зазвичай цей скрипт **не призначений для прямого запуску**.
-   **`install_dev_tools.sh`**:
    Встановлює поширені інструменти розробки, корисні при роботі з інфраструктурним кодом, такі як лінтери. Наразі включає:
-   **`install_infra_utils.sh`**: Встановлює різноманітні **допоміжні утиліти**, корисні для загальної роботи з інфраструктурою, взаємодії з платформами віртуалізації (як Proxmox, опосередковано), керування образами, обробки даних тощо. Цей скрипт не залежить від `install_iac_tools.sh` і встановлює інструменти, такі як `curl`, `wget`, `jq`, `qemu-utils` (з безпечною перевіркою на Proxmox), `pwgen`, `virt-what`, а також опціонально обробляє налаштування SSH ключів, `sshpass` та інструменти Python (`proxmoxer`).

## Використання: `install_iac_tools.sh`

Це основний скрипт для виконання для налаштування інструментів.

### Вимоги:

-   **Операційна система:** Дистрибутив Linux на базі Debian або Ubuntu.
-   **Оболонка:** `bash`.
-   **Утиліти:** Потрібне підключення до Інтернету для завантаження пакунків. Ключові утиліти, такі як `lsb_release`, `curl`, `gpg`, `wget`, будуть встановлені скриптом за потреби (в рамках `prepare_system`).
-   **Права:** Потрібні права root. Запускайте скрипт за допомогою `sudo`.

### Команда:

```bash
# Перейдіть до директорії scripts, якщо ви склонували репозиторій
 cd /шлях/до/infra-commons/scripts

# Виконайте з sudo
 sudo bash ./install_iac_tools.sh [ОПЦІЇ]
```

### Опції:

-   `(без опцій)`: Встановлює стандартні інструменти IaC (Ansible, OpenTofu) та необхідні залежності.
-   \`--dev\`: Встановлює стандартні інструменти IaC (Ansible, OpenTofu) ТА поширені інструменти розробки (наприклад, `shellcheck`).
-   \`--dev-only\`: Встановлює ТІЛЬКИ поширені інструменти розробки (наприклад, `shellcheck`), пропускаючи Ansible, OpenTofu та їх основні залежності.
-   \`-h\`, \`--help\`: Показує повідомлення довідки та виходить.

### Приклади:

1.  **Встановити тільки інструменти IaC (Ansible, OpenTofu):**
    ```bash
    sudo bash ./install_iac_tools.sh
    ```
2.  **Встановити інструменти IaC ТА інструменти розробки:**
    ```bash
    sudo bash ./install_iac_tools.sh --dev
    ```
3.  **Встановити ТІЛЬКИ інструменти розробки:**
    ```bash
    sudo bash ./install_iac_tools.sh --dev-only
    ```

## Як це Працює (`install_iac_tools.sh`)

1.  Скрипт `install_iac_tools.sh` спочатку аналізує опції командного рядка (наприклад, `--dev`, `--dev-only`, `--help`).
2.  Він перевіряє, чи запущений з правами root (`sudo`).
3.  **Якщо НЕ використовується** `--dev-only`:
    * Він викликає `prepare_system()` для виконання `apt-get update` та встановлення основних залежностей (`wget`, `curl`, `gpg` тощо).
    * Він визначає правильне кодове ім'я PPA для Ansible на основі ОС.
    * Він виконує `install_ansible.sh` (передаючи кодове ім'я).
    * Він виконує `install_opentofu.sh`.
4.  **Якщо було вказано** `--dev` **або** `--dev-only`:
    * Він виконує `install_dev_tools.sh`. Цей скрипт запускає `apt-get update` знову (що безпечно), а потім встановлює інструменти, такі як `shellcheck`.
5.  Нарешті, він виводить зведення встановлених компонентів.

---

## Використання: `install_infra_utils.sh`

Цей скрипт встановлює допоміжні інфраструктурні утиліти. Може запускатися незалежно.

**Вимоги:**

* **Операційна система:** Дистрибутив Linux на базі Debian або Ubuntu.
* **Оболонка:** `bash`.
* **Утиліти:** Потрібне підключення до Інтернету для завантаження пакунків. `sudo` потрібен для встановлення пакунків, якщо скрипт запускається не від імені root. Очікується наявність базових утиліт, таких як `dpkg`, `apt`, `command`, `grep`, `tput`.
* **Права:** Можуть знадобитися права root для встановлення пакунків. Скрипт намагається використати `sudo`, якщо запущений від звичайного користувача.

**Команда:**

```bash
# Перейдіть до директорії scripts, якщо ви склонували репозиторій
# cd /шлях/до/infra-commons/scripts
# Виконайте скрипт
bash ./install_infra_utils.sh [ОПЦІЇ]
```
*Примітка: `sudo` може знадобитися всередині скрипту, якщо він запущений не від імені root.*

**Опції:**

* `(без опцій)`: Встановлює базові утиліти (`wget`, `curl`, `jq`, `virt-what`, `pwgen`, перевіряє/пропускає `qemu-utils` залежно від типу хоста) та виконує перевірку/генерацію SSH ключа.
* `-h`, `--help`: Показує повідомлення довідки та виходить.
* `-l`, `--list-utils`: Виводить список утиліт, які може встановити цей скрипт, та виходить.
* `--no-ssh-keygen`: Пропускає крок перевірки/генерації SSH ключа.
* `--install-python`: Встановлює Python3, pip та бібліотеку 'proxmoxer'.
* `--install-sshpass`: Встановлює 'sshpass' (використовуйте з обережністю).

**Приклади:**

1.  **Встановити базові утиліти та перевірити/згенерувати SSH ключ:**
    ```bash
    bash ./install_infra_utils.sh
    ```
2.  **Вивести список доступних утиліт:**
    ```bash
    bash ./install_infra_utils.sh --list-utils
    ```
3.  **Встановити базові утиліти, інструменти Python, але пропустити перевірку SSH ключа:**
    ```bash
    bash ./install_infra_utils.sh --install-python --no-ssh-keygen
    ```
## Перевірка

Після запуску скриптів ви можете перевірити встановлення за допомогою наступних команд:

* `ansible --version` (якщо встановлено через `install_iac_tools.sh`)
* `tofu --version` (якщо встановлено через `install_iac_tools.sh`)
* `shellcheck --version` (якщо встановлено з прапорцями `--dev` або `--dev-only` у `install_iac_tools.sh`)
* `jq --version` (якщо встановлено через `install_infra_utils.sh`)
* `qemu-img --version` (якщо було встановлено `qemu-utils` або якщо виконується на Proxmox)
* `pwgen --help` (якщо встановлено через `install_infra_utils.sh`)
* `virt-what --version` (якщо встановлено через `install_infra_utils.sh`)
